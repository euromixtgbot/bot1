# Simple Bot

Телеграм-бот для интеграции с Jira и создания заявок.

## Обработка ошибок валидации

Бот умеет обрабатывать ошибки валидации полей при создании задачи в Jira:

1. **Пользовательские поля** (division, department, service) - при ошибках валидации эти поля будут автоматически удалены из запроса
2. **Поле Reporter** - при ошибке валидации репортера, бот автоматически заменяет значение на указанное в `JIRA_REPORTER_ACCOUNT_ID`
3. **Повторные попытки** - бот делает до 4-х попыток создания задачи с постепенным удалением проблемных полей

## Работа с комментариями

После создания задачи:
1. **Автоматический режим комментирования** - сразу после создания задачи автоматически включается режим комментирования
2. **Добавление комментариев** - можно просто написать текст в чат и он будет добавлен как комментарий к активной задаче
3. **Вложения файлов** - можно отправить файл или фото, которые будут добавлены как вложения к задаче

## Форматирование сообщений

Все сообщения бота используют Markdown-форматирование:
1. **Выделение ключевой информации** - важные элементы (номера задач, статусы) выделяются жирным шрифтом
2. **Курсив для пояснений** - дополнительная информация и инструкции отображаются курсивом
3. **Моноширинный шрифт** - технические данные (имена файлов, коды задач) отображаются в моноширинном шрифте

## Структура проекта

```
/
├── main.py                 # Основной файл запуска бота
├── handlers.py             # Обработчики команд и сообщений
├── keyboards.py            # Клавиатуры для интерфейса бота
├── services.py             # Сервисы для работы с API
├── config.py               # Конфигурационные параметры
├── constants.py            # Константы, используемые в проекте
├── jira_field_mappings.py  # Маппинги полей Jira
├── field_mapping.py        # Маппинги полей между системами
├── restart.sh              # Скрипт для перезапуска бота
├── requirements.txt        # Зависимости проекта
├── credentials.env         # Файл с учетными данными (не в Git)
├── service_account.json    # Учетные данные для Google API (не в Git)
├── logs/                   # Директория для логов
│   ├── bot.log             # Основной лог бота
│   ├── bot_new.log         # Лог текущего запуска
│   ├── bot_restart_history.log # История перезапусков
│   ├── conflict_errors.log # Логирование конфликтов API
│   ├── bot.pid             # Файл с PID процесса бота
│   └── bot.lock            # Файл блокировки для предотвращения дублирования
├── tests/                  # Директория с тестами
│   ├── test_jira_issue_create.py # Тесты создания заявок
│   └── test_jira_field_verification.py # Тесты верификации полей
└── unused/                 # Неиспользуемые или устаревшие файлы
    └── get_jira_fields.py  # Скрипт для получения полей из Jira
```

## Запуск бота

```bash
# Запуск основного бота
python main.py

# Или через скрипт рестарта (рекомендуется для production)
./restart.sh
```

## Логирование

Логи сохраняются в директории `logs/`. Основной лог бота находится в `logs/bot.log`.
