# üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –°—Ç–∞—Ä–∏—Ö –§–∞–π–ª—ñ–≤ –ø—Ä–∏ Webhook

**–î–∞—Ç–∞:** 2025-10-09 00:58  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û  
**Bot PID:** 30235  
**–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç:** HIGH

---

## üìã –í–∏—è–≤–ª–µ–Ω–∞ –ü—Ä–æ–±–ª–µ–º–∞

### –°–∏–º–ø—Ç–æ–º–∏
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ–¥–∞–≤ 2 –Ω–æ–≤—ñ —Ñ–∞–π–ª–∏ (PDF + DOCX) –¥–æ Jira —á–µ—Ä–µ–∑ –∫–æ–º–µ–Ω—Ç–∞—Ä –æ **00:48**, –∞–ª–µ –≤ Telegram –æ—Ç—Ä–∏–º–∞–≤ **6 —Å—Ç–∞—Ä–∏—Ö —Ñ–∞–π–ª—ñ–≤** (—Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ) + 2 –Ω–æ–≤—ñ —Ñ–∞–π–ª–∏.

### –ê–Ω–∞–ª—ñ–∑ –õ–æ–≥—ñ–≤

**00:48:23** - –°–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–π—à–ª–∞ 7 —Ñ–∞–π–ª—ñ–≤ –∑–∞–º—ñ—Å—Ç—å 2:

```
‚úÖ video_AgADUYcAAslbOEs.mp4 (time_diff: 164.1s) - –°–¢–ê–†–ò–ô —Ñ–∞–π–ª ‚ùå
‚úÖ photo_AQADr_oxG8lbOEt9.jpg (time_diff: 89.3s) - –°–¢–ê–†–ò–ô —Ñ–∞–π–ª ‚ùå
‚úÖ image_2024-02-19_12-12-35.png (time_diff: 49.9s) - –°–¢–ê–†–ò–ô —Ñ–∞–π–ª ‚ùå
‚úÖ photo_AQADr_oxG8lbOEt9.jpg (time_diff: 49.6s) - –°–¢–ê–†–ò–ô —Ñ–∞–π–ª ‚ùå
‚úÖ video_AgADUocAAslbOEs.mp4 (time_diff: 48.3s) - –°–¢–ê–†–ò–ô —Ñ–∞–π–ª ‚ùå
‚úÖ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ —Ä–æ–±–æ—Ç—ñ –∑ –ß–∞—Ç-–ë–æ—Ç–æ–º_2025 08 06.docx (time_diff: 5.3s) - –ù–û–í–ò–ô ‚úì
‚úÖ 20-12137509-08092025.PDF (time_diff: 5.1s) - –ù–û–í–ò–ô ‚úì
```

### –õ–æ–≥ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```
2025-10-09 00:48:23,148 - src.jira_webhooks2 - INFO - üîç STRATEGY 3: Searching by timestamp within 180s of comment
2025-10-09 00:48:23,149 - src.jira_webhooks2 - INFO - ‚úÖ MATCHED by timestamp: video_AgADUYcAAslbOEs.mp4 (time_diff: 164.1s)
2025-10-09 00:48:23,149 - src.jira_webhooks2 - INFO - ‚úÖ MATCHED by timestamp: photo_AQADr_oxG8lbOEt9.jpg (time_diff: 89.3s)
...
2025-10-09 00:48:23,150 - src.jira_webhooks2 - INFO - üéØ TOTAL FOUND via all strategies: 7 attachments
```

---

## üîç –ü–µ—Ä—à–æ–ø—Ä–∏—á–∏–Ω–∞ (Root Cause)

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ1: –ó–∞–Ω–∞–¥—Ç–æ –®–∏—Ä–æ–∫–µ –í—ñ–∫–Ω–æ Timestamp (180 —Å–µ–∫—É–Ω–¥)

**–õ–æ–∫–∞—Ü—ñ—è:** `src/jira_webhooks2.py:1680`

**–ë—É–ª–æ:**
```python
time_window = 180  # —Å–µ–∫—É–Ω–¥ - –∑–±—ñ–ª—å—à–µ–Ω–æ –∑ 30 –¥–æ 180 –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–∞–∫–µ—Ç–Ω–∏—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í—ñ–∫–Ω–æ **180 —Å–µ–∫—É–Ω–¥ (3 —Ö–≤–∏–ª–∏–Ω–∏)** –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–µ
- –ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –Ω–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤ —Å–∏—Å—Ç–µ–º–∞ –∑–∞—Ö–æ–ø–ª—é—î **–≤—Å—ñ —Ñ–∞–π–ª–∏ –∑ ID-–∫–µ—à—É** –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 3 —Ö–≤–∏–ª–∏–Ω–∏
- –°—Ç–∞—Ä—ñ —Ñ–∞–π–ª–∏ (—Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ä–∞–Ω—ñ—à–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è) –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å —É –≤–∏–±—ñ—Ä–∫—É

### –õ–æ–≥—ñ–∫–∞ STRATEGY 3:

```python
# –ü–æ—à—É–∫ –∑–∞ —á–∞—Å–æ–≤–∏–º–∏ –º—ñ—Ç–∫–∞–º–∏
for att_id, cached_data in ATTACHMENT_ID_CACHE.items():
    cached_timestamp = cached_data.get('timestamp', 0)
    time_diff = abs(comment_timestamp - cached_timestamp)
    
    if time_diff <= time_window:  # ‚ùå time_window=180s –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–µ
        found_attachments.append(cached_attachment)
```

**–ù–∞—Å–ª—ñ–¥–æ–∫:**
–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ–¥–∞–≤ —Ñ–∞–π–ª–∏ –æ 00:48:23, —Å–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–π—à–ª–∞ **–≤—Å—ñ —Ñ–∞–π–ª–∏ –∑ –∫–µ—à—É**, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –º—ñ–∂ 00:45:23 —Ç–∞ 00:51:23 (¬±3 —Ö–≤–∏–ª–∏–Ω–∏).

---

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ2: –û–±—Ä–æ–±–ª–µ–Ω—ñ –§–∞–π–ª–∏ –ó–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ ID-–ö–µ—à—ñ

**–õ–æ–∫–∞—Ü—ñ—è:** `src/jira_webhooks2.py:292`

**–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞:**
```python
ATTACHMENT_ID_CACHE_TTL = 600  # 10 minutes - INCREASED for debugging
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—è —Ñ–∞–π–ª–∏ **–ù–ï –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è** –∑ `ATTACHMENT_ID_CACHE`
- –í–æ–Ω–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ –∫–µ—à—ñ **10 —Ö–≤–∏–ª–∏–Ω**
- –ü—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ **–∑–Ω–æ–≤—É –∑–∞—Ö–æ–ø–ª—é—é—Ç—å—Å—è** —á–µ—Ä–µ–∑ STRATEGY 3

**–§—É–Ω–∫—Ü—ñ—è `cleanup_attachment_cache()`:**
```python
def cleanup_attachment_cache() -> None:
    # –í–∏–¥–∞–ª—è—î –¢–Ü–õ–¨–ö–ò —Ñ–∞–π–ª–∏ —Å—Ç–∞—Ä—ñ—à—ñ –∑–∞ TTL (600s)
    if current_time - cache_entry["timestamp"] > ATTACHMENT_ID_CACHE_TTL:
        del ATTACHMENT_ID_CACHE[att_id]
    # ‚ùå –ù–ï –≤–∏–¥–∞–ª—è—î –≤–∂–µ –æ–±—Ä–æ–±–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏!
```

---

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è ‚Ññ1: –ó–º–µ–Ω—à–µ–Ω–Ω—è Time Window (180s ‚Üí 30s)

**–§–∞–π–ª:** `src/jira_webhooks2.py:1680`

**–ë—É–ª–æ:**
```python
time_window = 180  # —Å–µ–∫—É–Ω–¥ - –∑–±—ñ–ª—å—à–µ–Ω–æ –∑ 30 –¥–æ 180 –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–∞–∫–µ—Ç–Ω–∏—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å
logger.info(f"üîç STRATEGY 3: Searching by timestamp within {time_window}s of comment")
```

**–°—Ç–∞–ª–æ:**
```python
time_window = 30  # —Å–µ–∫—É–Ω–¥ - –∑–º–µ–Ω—à–µ–Ω–æ –∑—ñ 180 –¥–æ 30, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö —Ñ–∞–π–ª—ñ–≤
logger.info(f"üîç STRATEGY 3: Searching by timestamp within {time_window}s of comment")
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –í—ñ–∫–Ω–æ **30 —Å–µ–∫—É–Ω–¥** –¥–æ—Å—Ç–∞—Ç–Ω—î –¥–ª—è –æ–±—Ä–æ–±–∫–∏ webhook events
- ‚úÖ Webhook –∑–∞–∑–≤–∏—á–∞–π –ø—Ä–∏—Ö–æ–¥—è—Ç—å –∑–∞ **5-10 —Å–µ–∫—É–Ω–¥** –ø—ñ—Å–ª—è –¥—ñ—ó
- ‚úÖ –°—Ç–∞—Ä—ñ —Ñ–∞–π–ª–∏ (>30s) **–ù–ï –∑–∞—Ö–æ–ø–ª—é—é—Ç—å—Å—è**

---

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è ‚Ññ2: –û—á–∏—Å—Ç–∫–∞ –û–±—Ä–æ–±–ª–µ–Ω–∏—Ö –§–∞–π–ª—ñ–≤ –∑ ID-–ö–µ—à—É

**–§–∞–π–ª:** `src/jira_webhooks2.py:1301`

**–î–æ–¥–∞–Ω–æ –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ —Ñ–∞–π–ª—ñ–≤:**
```python
logger.info(f"üèÅ Attachment processing complete: {success_count} successful, {error_count} failed")

# –û—á–∏—â–∞—î–º–æ –æ–±—Ä–æ–±–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏ –∑ ID-–∫–µ—à—É, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏
for attachment in unique_attachments:
    att_id = attachment.get('id')
    if att_id and att_id in ATTACHMENT_ID_CACHE:
        filename = attachment.get('filename', 'unknown')
        logger.info(f"üóëÔ∏è Removing processed attachment from ID cache: {filename} (ID: {att_id})")
        del ATTACHMENT_ID_CACHE[att_id]
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –û–±—Ä–æ–±–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏ **–æ–¥—Ä–∞–∑—É –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è** –∑ –∫–µ—à—É
- ‚úÖ **–ù–ï –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞—Ö–æ–ø–ª–µ–Ω—ñ** –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–µ–Ω—Ç–∞—Ä—è—Ö
- ‚úÖ –ö–µ—à –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —á–∏—Å—Ç–∏–º

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: –î–æ —ñ –ü—ñ—Å–ª—è

### –î–æ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–Ω—è |
|----------|----------|
| Time Window | **180 —Å–µ–∫—É–Ω–¥ (3 —Ö–≤–∏–ª–∏–Ω–∏)** ‚ùå |
| –û—á–∏—Å—Ç–∫–∞ ID-–∫–µ—à—É | –¢—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è TTL (600s) ‚ùå |
| –°—Ç–∞—Ä—ñ —Ñ–∞–π–ª–∏ | –ó–∞—Ö–æ–ø–ª—é—é—Ç—å—Å—è ‚ùå |
| –î—É–±–ª—ñ–∫–∞—Ç–∏ | –ú–æ–∂–ª–∏–≤—ñ ‚ùå |

**–°—Ü–µ–Ω–∞—Ä—ñ–π:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–¥—Å–∏–ª–∞—î —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ ‚Üí –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –∫–µ—à—ñ
2. –ß–µ—Ä–µ–∑ 2 —Ö–≤–∏–ª–∏–Ω–∏ –¥–æ–¥–∞—î PDF/DOCX
3. **–°–∏—Å—Ç–µ–º–∞ –∑–∞—Ö–æ–ø–ª—é—î —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ + PDF/DOCX** (–≤—Å—ñ —É –≤—ñ–∫–Ω—ñ 180s)
4. –¢–µ–ª–µ–≥—Ä–∞–º –æ—Ç—Ä–∏–º—É—î **—Å—Ç–∞—Ä—ñ + –Ω–æ–≤—ñ —Ñ–∞–π–ª–∏** ‚ùå

---

### –ü—ñ—Å–ª—è –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–Ω—è |
|----------|----------|
| Time Window | **30 —Å–µ–∫—É–Ω–¥** ‚úÖ |
| –û—á–∏—Å—Ç–∫–∞ ID-–∫–µ—à—É | –û–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ ‚úÖ |
| –°—Ç–∞—Ä—ñ —Ñ–∞–π–ª–∏ | –ù–ï –∑–∞—Ö–æ–ø–ª—é—é—Ç—å—Å—è ‚úÖ |
| –î—É–±–ª—ñ–∫–∞—Ç–∏ | –í—ñ–¥—Å—É—Ç–Ω—ñ ‚úÖ |

**–°—Ü–µ–Ω–∞—Ä—ñ–π:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–¥—Å–∏–ª–∞—î —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ ‚Üí –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –∫–µ—à—ñ
2. –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–æ–±–ª—è—î ‚Üí **–≤–∏–¥–∞–ª—è—î –∑ ID-–∫–µ—à—É**
3. –ß–µ—Ä–µ–∑ 2 —Ö–≤–∏–ª–∏–Ω–∏ –¥–æ–¥–∞—î PDF/DOCX
4. **–°–∏—Å—Ç–µ–º–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –¢–Ü–õ–¨–ö–ò PDF/DOCX** (—Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ –≤–∂–µ –≤–∏–¥–∞–ª–µ–Ω—ñ –∑ –∫–µ—à—É)
5. –¢–µ–ª–µ–≥—Ä–∞–º –æ—Ç—Ä–∏–º—É—î **—Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ —Ñ–∞–π–ª–∏** ‚úÖ

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –°–∏–Ω—Ç–∞–∫—Å–∏—Å—É
```bash
‚úÖ python3 -m py_compile src/jira_webhooks2.py
‚úÖ –ñ–æ–¥–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ë–æ—Ç–∞
```bash
‚úÖ sudo systemctl restart telegram-bot.service
‚úÖ Bot PID: 30235
‚úÖ Status: Active (running)
```

### –û—á—ñ–∫—É–≤–∞–Ω–∞ –ü–æ–≤–µ–¥—ñ–Ω–∫–∞

**–¢–µ—Å—Ç 1: –î–æ–¥–∞–≤–∞–Ω–Ω—è 2 –Ω–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤**
1. –î–æ–¥–∞—Ç–∏ PDF + DOCX —á–µ—Ä–µ–∑ Jira –∫–æ–º–µ–Ω—Ç–∞—Ä
2. **–û—á—ñ–∫—É—î—Ç—å—Å—è:** Telegram –æ—Ç—Ä–∏–º–∞—î –¢–Ü–õ–¨–ö–ò 2 —Ñ–∞–π–ª–∏ (PDF + DOCX)
3. –°—Ç–∞—Ä—ñ —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ **–ù–ï –±—É–¥—É—Ç—å** –Ω–∞–¥—ñ—Å–ª–∞–Ω—ñ

**–¢–µ—Å—Ç 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤**
```
üîç STRATEGY 3: Searching by timestamp within 30s of comment
‚úÖ MATCHED by timestamp: file1.pdf (time_diff: 5.1s)
‚úÖ MATCHED by timestamp: file2.docx (time_diff: 5.3s)
‚è∞ TOO OLD: old_photo.jpg (time_diff: 89.3s > 30s)  ‚Üê ‚úÖ –°—Ç–∞—Ä—ñ —Ñ–∞–π–ª–∏ —ñ–≥–Ω–æ—Ä—É—é—Ç—å—Å—è
üéØ TOTAL FOUND: 2 attachments  ‚Üê ‚úÖ –¢—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ
```

**–¢–µ—Å—Ç 3: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à—É**
```
üèÅ Attachment processing complete: 2 successful, 0 failed
üóëÔ∏è Removing processed attachment from ID cache: file1.pdf (ID: 143830)
üóëÔ∏è Removing processed attachment from ID cache: file2.docx (ID: 143831)
```

---

## üìà –¢–µ—Ö–Ω—ñ—á–Ω—ñ –î–µ—Ç–∞–ª—ñ

### –ñ–∏—Ç—Ç—î–≤–∏–π –¶–∏–∫–ª –§–∞–π–ª—É (–î–æ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è) ‚ùå

```
1. attachment_created webhook ‚Üí –¥–æ–¥–∞–Ω–æ –¥–æ ATTACHMENT_ID_CACHE
   ‚îî‚îÄ timestamp: 00:45:00, TTL: 600s (–¥–æ 00:55:00)

2. comment_created webhook (00:45:10)
   ‚îî‚îÄ STRATEGY 3: time_window=180s (00:42:10 - 00:48:10)
   ‚îî‚îÄ –ó–ù–ê–ô–î–ï–ù–û: —Ñ–∞–π–ª (time_diff: 10s)
   ‚îî‚îÄ –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–æ Telegram ‚úì

3. –§–∞–π–ª –ó–ê–õ–ò–®–ê–Ñ–¢–¨–°–Ø –≤ ATTACHMENT_ID_CACHE –¥–æ 00:55:00 ‚ùå

4. –ù–æ–≤–∏–π comment_created webhook (00:48:00)
   ‚îî‚îÄ STRATEGY 3: time_window=180s (00:45:00 - 00:51:00)
   ‚îî‚îÄ –ó–ù–ê–ô–î–ï–ù–û: —Å—Ç–∞—Ä–∏–π —Ñ–∞–π–ª (time_diff: 180s) ‚ùå
   ‚îî‚îÄ –ü–û–í–¢–û–†–ù–û –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–æ Telegram ‚ùå‚ùå‚ùå
```

---

### –ñ–∏—Ç—Ç—î–≤–∏–π –¶–∏–∫–ª –§–∞–π–ª—É (–ü—ñ—Å–ª—è –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è) ‚úÖ

```
1. attachment_created webhook ‚Üí –¥–æ–¥–∞–Ω–æ –¥–æ ATTACHMENT_ID_CACHE
   ‚îî‚îÄ timestamp: 00:45:00

2. comment_created webhook (00:45:10)
   ‚îî‚îÄ STRATEGY 3: time_window=30s (00:44:40 - 00:45:40)
   ‚îî‚îÄ –ó–ù–ê–ô–î–ï–ù–û: —Ñ–∞–π–ª (time_diff: 10s)
   ‚îî‚îÄ –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–æ Telegram ‚úì
   ‚îî‚îÄ –í–ò–î–ê–õ–ï–ù–û –∑ ATTACHMENT_ID_CACHE ‚úÖ

3. –ù–æ–≤–∏–π comment_created webhook (00:48:00)
   ‚îî‚îÄ STRATEGY 3: time_window=30s (00:47:30 - 00:48:30)
   ‚îî‚îÄ –°—Ç–∞—Ä–∏–π —Ñ–∞–π–ª –í–Ü–î–°–£–¢–ù–Ü–ô –≤ –∫–µ—à—ñ ‚úÖ
   ‚îî‚îÄ –ó–Ω–∞–π–¥–µ–Ω–æ –¢–Ü–õ–¨–ö–ò –Ω–æ–≤—ñ —Ñ–∞–π–ª–∏ ‚úÖ
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

| –ü—Ä–æ–±–ª–µ–º–∞ | –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è | –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è |
|----------|----------------|-------------------|
| **Time Window** | 180s (–∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–µ) | 30s (–æ–ø—Ç–∏–º–∞–ª—å–Ω–µ) ‚úÖ |
| **–ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö —Ñ–∞–π–ª—ñ–≤** | –¢–∞–∫ ‚ùå | –ù—ñ ‚úÖ |
| **–û—á–∏—Å—Ç–∫–∞ –∫–µ—à—É** | –ß–µ—Ä–µ–∑ 10 —Ö–≤–∏–ª–∏–Ω | –û–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ ‚úÖ |
| **–î—É–±–ª—ñ–∫–∞—Ç–∏** | –ú–æ–∂–ª–∏–≤—ñ | –í—ñ–¥—Å—É—Ç–Ω—ñ ‚úÖ |
| **–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ñ–∞–π–ª—ñ–≤ —É Telegram** | 7 (5 —Å—Ç–∞—Ä–∏—Ö + 2 –Ω–æ–≤–∏—Ö) | 2 (—Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ) ‚úÖ |

---

## üìù –ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –§–∞–π–ª–∏

**src/jira_webhooks2.py** - 2 –∑–º—ñ–Ω–∏:
1. **–†—è–¥–æ–∫ 1680:** –ó–º–µ–Ω—à–µ–Ω–æ `time_window` –∑—ñ 180s –¥–æ 30s
2. **–†—è–¥–æ–∫ 1301:** –î–æ–¥–∞–Ω–æ –æ—á–∏—Å—Ç–∫—É –æ–±—Ä–æ–±–ª–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∑ `ATTACHMENT_ID_CACHE`

---

## üöÄ –°—Ç–∞—Ç—É—Å –î–µ–ø–ª–æ—é

```
‚úÖ –§–∞–π–ª –º–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ: src/jira_webhooks2.py (2 –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è)
‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ: python3 -m py_compile ‚Üí OK
‚úÖ Bot –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ: PID 30235
‚úÖ Telegram webhook: –∞–∫—Ç–∏–≤–µ–Ω
‚úÖ Jira webhook: –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ 0.0.0.0:9443
```

---

## üìå –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### –ö–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ
1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ —á–µ—Ä–µ–∑ Jira
2. ‚úÖ –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ —Å—Ç–∞—Ä—ñ —Ñ–∞–π–ª–∏ –ù–ï –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è
3. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å "TOO OLD" –¥–ª—è —Å—Ç–∞—Ä–∏—Ö —Ñ–∞–π–ª—ñ–≤

### –°–µ—Ä–µ–¥–Ω—å–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ
1. –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä `ATTACHMENT_ID_CACHE` (–º–∞—î –±—É—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º)
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ (–º–∞—é—Ç—å –∑–Ω–∏–∫–Ω—É—Ç–∏)
3. –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è —â–æ –≤—Å—ñ –Ω–æ–≤—ñ —Ñ–∞–π–ª–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è

### –î–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ
1. –†–æ–∑–≥–ª—è–Ω—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Redis –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è (–∑–∞–º—ñ—Å—Ç—å in-memory dict)
2. –î–æ–¥–∞—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Ä–æ–∑–º—ñ—Ä—É –∫–µ—à—É
3. –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ TTL –Ω–∞ —Ä—ñ–≤–Ω—ñ –æ–∫—Ä–µ–º–∏—Ö —Ñ–∞–π–ª—ñ–≤

---

## ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫

–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ **–∫—Ä–∏—Ç–∏—á–Ω—É –ø—Ä–æ–±–ª–µ–º—É** –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö —Ñ–∞–π–ª—ñ–≤:

1. ‚úÖ **Time Window –∑–º–µ–Ω—à–µ–Ω–æ** –∑—ñ 180s –¥–æ 30s
2. ‚úÖ **–û–±—Ä–æ–±–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è** –∑ ID-–∫–µ—à—É –æ–¥—Ä–∞–∑—É
3. ‚úÖ **–°—Ç–∞—Ä—ñ —Ñ–∞–π–ª–∏ –ù–ï –∑–∞—Ö–æ–ø–ª—é—é—Ç—å—Å—è** –ø–æ–≤—Ç–æ—Ä–Ω–æ
4. ‚úÖ **–î—É–±–ª—ñ–∫–∞—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ**

**–ë–æ—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è! üéâ**

–¢–µ–ø–µ—Ä –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –Ω–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤ —á–µ—Ä–µ–∑ Jira –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º–∞—î –≤ Telegram **–¢–Ü–õ–¨–ö–ò –Ω–æ–≤—ñ —Ñ–∞–π–ª–∏**, –±–µ–∑ —Å—Ç–∞—Ä–∏—Ö —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ.

---

**–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ:** GitHub Copilot  
**–î–∞—Ç–∞ –∑–≤—ñ—Ç—É:** 2025-10-09 00:58 UTC  
**Bot Status:** ‚úÖ Running (PID 30235)
