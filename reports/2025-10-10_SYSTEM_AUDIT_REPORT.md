# –ó–≤—ñ—Ç –∑ –∞—É–¥–∏—Ç—É Telegram‚ÄìJira –±–æ—Ç–∞

**–î–∞—Ç–∞ –ø–µ—Ä–≤–∏–Ω–Ω–æ–≥–æ –∞—É–¥–∏—Ç—É:** 10 –∂–æ–≤—Ç–Ω—è 2025 —Ä–æ–∫—É  \
**–û–Ω–æ–≤–ª–µ–Ω–æ:** 13 –∂–æ–≤—Ç–Ω—è 2025 —Ä–æ–∫—É (–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –ø–æ—Ç–æ—á–Ω–æ–º—É –∫–æ–¥—É)  \
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏, —â–æ –∞–Ω–∞–ª—ñ–∑—É–≤–∞–ª–∏—Å—å:** `src/main.py`, `src/handlers.py`, `src/jira_webhooks2.py`, `src/services.py`, `src/google_sheets_service.py`, `src/user_state_service.py`, —Å—É–ø—É—Ç–Ω—ñ –º–æ–¥—É–ª—ñ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω–æ–º —Ç–∞ –∫–µ—à—É–≤–∞–Ω–Ω—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

## 1. –ö–æ—Ä–æ—Ç–∫—ñ –≤–∏—Å–Ω–æ–≤–∫–∏
- –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—î–¥–Ω—É—î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π Telegram –±–æ—Ç (`python-telegram-bot` v20) —Ç–∞ aiohttp-—Å–µ—Ä–≤–µ—Ä –¥–ª—è Jira –≤–µ–±—Ö—É–∫—ñ–≤ –∑ –ª–æ–∫–∞–ª—å–Ω–∏–º –∫–µ—à–µ–º —É JSON —ñ –æ—Å–Ω–æ–≤–Ω–∏–º —Å—Ö–æ–≤–∏—â–µ–º —É Google Sheets.
- –í–∏—è–≤–ª–µ–Ω–æ –∫—ñ–ª—å–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –≤—É–∑—å–∫–∏—Ö –º—ñ—Å—Ü—å: –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É, –±–ª–æ–∫—É–≤–∞–ª—å–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ Google Sheets —É—Å–µ—Ä–µ–¥–∏–Ω—ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤, –ø—Ä–æ–±–ª–µ–º–∏ –∑ –∫–æ—Ä–µ–∫—Ç–Ω–∏–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º –±–æ—Ç–∞, ¬´–≤–∞–∂–∫—ñ¬ª –≤–µ–±—Ö—É–∫–∏ Jira —Ç–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è HTTP-–∑‚Äô—î–¥–Ω–∞–Ω—å.
- –ó–Ω–∞—á–Ω–∏–π, –º–æ–Ω–æ–ª—ñ—Ç–Ω–∏–π –º–æ–¥—É–ª—å `handlers.py` —É—Å–∫–ª–∞–¥–Ω—é—î –ø—ñ–¥—Ç—Ä–∏–º–∫—É –π –º—ñ—Å—Ç–∏—Ç—å –¥—É–±–ª—ñ–∫–∞—Ç–∏ –ª–æ–≥—ñ–∫–∏; –Ω–∞—è–≤–Ω–∏–π –º–µ—Ä—Ç–≤–∏–π —Ç–∞ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π –∫–æ–¥.

## 2. –°—Ç–∏—Å–ª–∏–π –æ–ø–∏—Å –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
- **–ó–∞–ø—É—Å–∫ —ñ –∂–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª:** `src/main.py` —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫, –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –≤–µ–±—Ö—É–∫–∏, –∑–∞–ø—É—Å–∫–∞—î aiohttp-—Å–µ—Ä–≤–µ—Ä —ñ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–∏–π —Ü–∏–∫–ª —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
- **–û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ–≥–æ –ø–æ—Ç–æ–∫—É:** `src/handlers.py` (~3000 —Ä—è–¥–∫—ñ–≤) –º—ñ—Å—Ç–∏—Ç—å —É—Å—ñ ConversationHandler-–∏, –º–µ–Ω—é, –∫–∞—Å—Ç–æ–º–Ω—ñ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏ —Å—Ç–∞–Ω—ñ–≤ —Ç–∞ –≥–ª–æ–±–∞–ª—å–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏.
- **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Jira:** `src/services.py` —Ç–∞ `src/jira_webhooks2.py` –æ–±—Ä–æ–±–ª—è—é—Ç—å REST-–∑–∞–ø–∏—Ç–∏, —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∑–∞–¥–∞—á, –≤–∫–ª–∞–¥–µ–Ω—å —ñ –ø–æ–¥—ñ–π Jira.
- **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Google Sheets:** `src/google_sheets_service.py` —Ç–∞ `src/user_management_service.py` –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –∑ —Ç–∞–±–ª–∏—Ü–µ—é —Ç–∞ –ª–æ–∫–∞–ª—å–Ω–∏–º –∫–µ—à–µ–º (`user_states/`).

## 3. –ö—Ä–∏—Ç–∏—á–Ω—ñ —Ä–∏–∑–∏–∫–∏ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
### 3.1 –ü–æ–¥–≤—ñ–π–Ω–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—É
- **–ü—Ä–æ–±–ª–µ–º–∞:** `acquire_lock()` –≤–∏–¥–∞–ª—è—î `logs/bot.lock` –ø–µ—Ä–µ–¥ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è–º `fcntl`-–±–ª–æ–∫—É–≤–∞–Ω–Ω—è. –Ø–∫—â–æ —ñ–Ω—à–∏–π –ø—Ä–æ—Ü–µ—Å —É–∂–µ —É—Ç—Ä–∏–º—É—î —Å—Ç–∞—Ä–∏–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä, –æ–±–∏–¥–≤–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä–∏ –±–æ—Ç–∞ —Å—Ç–∞—Ä—Ç—É—é—Ç—å –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ. –î–æ–¥–∞—Ç–∫–æ–≤–æ `kill_existing_bot_processes()` –∑–∞–≤–µ—Ä—à—É—î –±—É–¥—å-—è–∫–∏–π `python main.py`, –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ —á—ñ–ø–ª—è—é—á–∏ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏.
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
  1. –ü—Ä–∏–±—Ä–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—É –ø–µ—Ä–µ–¥ `lockf`; –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä, —â–æ –∑–∞–ª–∏—à–∞—î —ñ—Å–Ω—É—é—á–∏–π `inode` –∂–∏–≤–∏–º.
  2. –ó–∞–º—ñ–Ω–∏—Ç–∏ —Ä—É—á–Ω–∏–π `ps`-—Å–∫–∞–Ω –Ω–∞ PID-—Ñ–∞–π–ª systemd –∞–±–æ –æ–±–º–µ–∂–∏—Ç–∏ –ø–æ—à—É–∫ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É —Å–µ—Ä–≤—ñ—Å—É.

### 3.2 –ë–ª–æ–∫—É–≤–∞–ª—å–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ —É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É —Ü–∏–∫–ª—ñ
- **–ü—Ä–æ–±–ª–µ–º–∞:** –í–∏–∫–ª–∏–∫–∏ –¥–æ Google Sheets —á–µ—Ä–µ–∑ `gspread` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `get_all_records`) –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä—è–º–æ –≤ handler-–∞—Ö —ñ –±–ª–æ–∫—É—é—Ç—å event-loop. Jira-–∑–∞–ø–∏—Ç–∏ –≤–∂–µ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ `httpx.AsyncClient`, –∞–ª–µ –∫–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —â–æ—Ä–∞–∑—É –∑–∞–Ω–æ–≤–æ, –≤–∏—Ç—Ä–∞—á–∞—é—á–∏ —Ä–µ—Å—É—Ä—Å–∏ –Ω–∞ TLS handshakes.
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
  1. –û–±–≥–æ—Ä–Ω—É—Ç–∏ Google Sheets-–æ–ø–µ—Ä–∞—Ü—ñ—ó —É `asyncio.to_thread` / –æ–∫—Ä–µ–º–∏–π –≤–æ—Ä–∫–µ—Ä –∞–±–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∫–ª—ñ—î–Ω—Ç –∑ –∫–µ—à–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.
  2. –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è (—Ö–æ—á–∞ –± —É –ø–∞–º º—è—Ç—ñ) –¥–ª—è `get_all_records`, –æ–±–º–µ–∂–∏—Ç–∏ –ø–æ–≤–Ω—ñ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ.
  3. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–ø—ñ–ª—å–Ω–∏–π `httpx.AsyncClient` —Ç–∞ –ø–µ—Ä–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ –∑–∞–º—ñ—Å—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –æ–± º—î–∫—Ç–∞ –≤ `_make_request`.

### 3.3 –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –±–æ—Ç–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** `await application.updater.stop()` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —É PTB v20, –¥–µ `updater` –≤–∂–µ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π, —â–æ —Å–ø—Ä–∏—á–∏–Ω—è—î `AttributeError` —Ç–∞ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è —Å–µ—Ä–≤—ñ—Å—ñ–≤.
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
  1. –ó–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ `await application.stop()` —ñ `await application.shutdown()`.
  2. –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ aiohttp runner –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è —É `finally` —Ç–∞ —Ñ–∞–π–ª –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ.

### 3.4 –í–∞–∂–∫—ñ Jira –≤–µ–±—Ö—É–∫–∏
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—Ä–æ–±–Ω–∏–∫ Jira –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ –≤–∏–∫–æ–Ω—É—î –¥—ñ—Å—Ç–∞–≤–∞–Ω–Ω—è –≤–∫–ª–∞–¥–µ–Ω—å —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫—É —É Telegram –¥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ Jira. –£ –ø—ñ–∫–æ–≤–∏–π –º–æ–º–µ–Ω—Ç —Ü–µ —Å–ø—Ä–∏—á–∏–Ω—è—î –ø–æ–≤—Ç–æ—Ä–Ω—ñ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –≤–µ–±—Ö—É–∫—ñ–≤ –≤—ñ–¥ Atlassian.
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
  1. –í—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ Jira –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –±–∞–∑–æ–≤–æ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó, –∞ –≤–∞–∂–∫—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó —Å—Ç–∞–≤–∏—Ç–∏ —É `asyncio.create_task` –∞–±–æ —á–µ—Ä–≥—É.
  2. –í–∏–Ω–µ—Å—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∫–ª–∞–¥–µ–Ω—å —É –æ–∫—Ä–µ–º—ñ –≤–æ—Ä–∫–µ—Ä–∏ –∑ rate-limit.

### 3.5 –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è HTTP-–∑‚Äô—î–¥–Ω–∞–Ω—å
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–∂–µ–Ω –≤–∏–∫–ª–∏–∫ `_make_request` —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π `httpx.AsyncClient`; TLS handshakes –ø–æ–≤—Ç–æ—Ä—é—é—Ç—å—Å—è, —Ä–æ—Å—Ç–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Å–æ–∫–µ—Ç—ñ–≤.
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
  1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–¥–∏–Ω `AsyncClient` (–∞–±–æ –ø—É–ª) –∑ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É.
  2. –û–Ω–æ–≤–∏—Ç–∏ retry/backoff –ª–æ–≥—ñ–∫—É, —Å–ø–∏—Ä–∞—é—á–∏—Å—å –Ω–∞ `httpx.AsyncClient` —Ç–∞ `Retry` middleware.

### 3.6 –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —ñ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—è
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–º–∞—î –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤ —á–µ—Ä–≥–∏ —Ç–µ–ª–µ–≥—Ä–∞–º-–æ–Ω–æ–≤–ª–µ–Ω—å, —á–∞—Å—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ Google Sheets —á–∏ –∑–∞—Ç—Ä–∏–º–æ–∫ Jira –≤–µ–±—Ö—É–∫—ñ–≤.
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
  1. –î–æ–¥–∞—Ç–∏ `/healthz` –∑ –∫–ª—é—á–æ–≤–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ (–≥–ª–∏–±–∏–Ω–∞ —á–µ—Ä–≥–∏, —Å–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å Sheet/Jira –∑–∞–ø–∏—Ç—ñ–≤).
  2. –ó–∞–ø–∏—Å—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É rate-limit –≤ Prometheus-friendly —Ñ–æ—Ä–º–∞—Ç –∞–±–æ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ —É –ª–æ–≥–∏ –∑ —Ç–µ–≥–∞–º–∏.

### 3.7 –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞:** `global_contact_handler()` –ø—Ä–∏–π–º–∞—î –±—É–¥—å-—è–∫–∏–π `Message.contact`. –í—ñ–¥—Å—É—Ç–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ `contact.user_id` –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ `update.effective_user.id`, —Ç–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —á—É–∂–∏–π –∫–æ–Ω—Ç–∞–∫—Ç —ñ –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è –ø—ñ–¥ —ñ–Ω—à–∏–º –ø—Ä–æ—Ñ—ñ–ª–µ–º.
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
  1. –í–∞–ª—ñ–¥—É–≤–∞—Ç–∏, —â–æ –∫–æ–Ω—Ç–∞–∫—Ç –Ω–∞–ª–µ–∂–∏—Ç—å –ø–æ—Ç–æ—á–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É; —É —Ä–∞–∑—ñ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –≤—ñ–¥—Ö–∏–ª—è—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é.
  2. –õ–æ–≥—É–≤–∞—Ç–∏ —Ç–∞–∫—ñ —Å–ø—Ä–æ–±–∏ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–∂—É–≤–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É.
  3. –î–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∏–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–π override —á–µ—Ä–µ–∑ whitelist.

## 4. –ü–æ–≤–µ–¥—ñ–Ω–∫–∞ –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º
| –°—Ü–µ–Ω–∞—Ä—ñ–π | –ü–æ—Ç–æ—á–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ | –ù–∞—Å–ª—ñ–¥–∫–∏ | –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –¥—ñ—è |
| --- | --- | --- | --- |
| –ú–∞—Å–æ–≤–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ | –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç —á–∏—Ç–∞—î –≤—Å—é —Ç–∞–±–ª–∏—Ü—é `get_all_records` | –ó–∞—Ç—Ä–∏–º–∫–∏ > 10 c, –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –±–æ—Ç–∞ | –ö–µ—à—É–≤–∞–Ω–Ω—è, –∞—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑–≤–µ—Ä–Ω–µ–Ω—å, —á–∞—Å—Ç–∫–æ–≤—ñ —ñ–Ω–¥–µ–∫—Å–∏ |
| –ë—É—Ä—Å—Ç Jira –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤/–≤–∫–ª–∞–¥–µ–Ω—å | –û–±—Ä–æ–±–∫–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∞, –≤–∫–ª—é—á–Ω–æ –∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º —Ñ–∞–π–ª—ñ–≤ | Jira –ø–æ–≤—Ç–æ—Ä—é—î –≤–µ–±—Ö—É–∫–∏, –∑‚Äô—è–≤–ª—è—é—Ç—å—Å—è –¥—É–±–ª—ñ–∫–∞—Ç–∏ | –ß–µ—Ä–≥–∞/–≤–æ—Ä–∫–µ—Ä–∏ –¥–ª—è –≤–∫–ª–∞–¥–µ–Ω—å, —à–≤–∏–¥–∫–∞ ACK-–≤—ñ–¥–ø–æ–≤—ñ–¥—å |
| –¢—Ä–∏–≤–∞–ª–µ –ø–∞–¥—ñ–Ω–Ω—è Google Sheets | –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –∑–∞–≤–∏—Å–∞—é—Ç—å | –ë–æ—Ç –Ω–µ —Ä–µ–∞–≥—É—î –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è | –¢–∞–π–º–∞—É—Ç–∏, fallback –Ω–∞ –∫–µ—à, circuit-breaker |
| –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π –∑–∞–ø—É—Å–∫ –¥–≤–æ—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ | Lock-—Ñ–∞–π–ª –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è | –î—É–±–ª—ñ–∫–∞—Ç–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏, –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ –ø–æ—Ä—Ç—É | –í–∏–ø—Ä–∞–≤–∏—Ç–∏ –º–µ–Ω–µ–¥–∂–µ—Ä –±–ª–æ–∫—É–≤–∞–Ω–Ω—è |

## 5. –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ—Å—Ç—å —Ç–∞ ¬´–º–µ—Ä—Ç–≤–∏–π¬ª –∫–æ–¥
1. **–ú–æ–Ω–æ–ª—ñ—Ç–Ω–∏–π `handlers.py`:**
   - *–ü—Ä–æ–±–ª–µ–º–∞:* ~3000 —Ä—è–¥–∫—ñ–≤ –∑ –¥—É–±–ª—é–≤–∞–Ω–Ω—è–º —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ (¬´üîô –ù–∞–∑–∞–¥¬ª, `comment_handler`) —Ç–∞ —Ä—É—á–Ω–∏–º –∫–µ—Ä—É–≤–∞–Ω–Ω—è–º —Å—Ç–∞–Ω–∞–º–∏.
   - *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:* –†–æ–∑–¥—ñ–ª–∏—Ç–∏ –Ω–∞ –º–æ–¥—É–ª—ñ (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–¥–∞—á, –ø—Ä–æ—Ñ—ñ–ª—å) —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤–±—É–¥–æ–≤–∞–Ω—ñ —Å—Ç–µ–π—Ç-—Ñ—ñ–ª—å—Ç—Ä–∏ PTB.
2. **`reset_registration_handler`:**
   - *–ü—Ä–æ–±–ª–µ–º–∞:* –í–∏–∫–ª–∏–∫–∞—î `complete_registration()`, —â–æ –ª–∏—à–µ –∑–º—ñ–Ω—é—î —Å—Ç–∞—Ç—É—Å, –Ω–µ –æ—á–∏—â–∞—é—á–∏ –∫–µ—à.
   - *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:* –î–æ–¥–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è/–æ—á–∏—â–µ–Ω–Ω—è `user_state_manager` —Ç–∞ `context.user_data`.
3. **`send_telegram_text` —É `jira_webhooks2.py`:**
   - *–ü—Ä–æ–±–ª–µ–º–∞:* –§—É–Ω–∫—Ü—ñ—è –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è, –¥—É–±–ª—é—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ PTB.
   - *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:* –í–∏–¥–∞–ª–∏—Ç–∏ –∞–±–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –≤–∏–∫–ª–∏–∫ —á–µ—Ä–µ–∑ `application.bot`.
4. **–ü–æ–¥–≤—ñ–π–Ω—ñ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —Ö–µ–Ω–¥–ª–µ—Ä—ñ–≤:**
   - *–ü—Ä–æ–±–ª–µ–º–∞:* `comment_handler` —Ç–∞ —ñ–Ω—à—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ –¥—É–±–ª—é—é—Ç—å—Å—è —É —Ä—ñ–∑–Ω–∏—Ö –≥—Ä—É–ø–∞—Ö.
   - *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:* –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ —Ç–∞ –ø—Ä–∏–±—Ä–∞—Ç–∏ –∑–∞–π–≤—ñ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó.
5. **–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Google Sheets –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ:**
   - *–ü—Ä–æ–±–ª–µ–º–∞:* –ü–æ–º–∏–ª–∫–∞ —É –∫—Ä–µ–¥–µ–Ω—à–∞–ª–∞—Ö –∑—É–ø–∏–Ω—è—î –º–æ–¥—É–ª—å –¥–æ —Å—Ç–∞—Ä—Ç—É –±–æ—Ç–∞.
   - *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:* –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –≤ lazy-—Ñ—É–Ω–∫—Ü—ñ—é –∑ –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫.

## 6. –î–µ—Ç–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω –ø–æ–∫—Ä–∞—â–µ–Ω—å

### 6.1 –ë–µ–∑–ø–µ–∫–∞ –∑–∞–ø—É—Å–∫—É —Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (P0)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ä–∞–∑:** –∑–∞–ø—É—Å–∫ —É `src/main.py` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `kill_existing_bot_processes()`, `acquire_lock()` —ñ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π —Ü–∏–∫–ª `main()`. Lock-—Ñ–∞–π–ª —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –≤ `logs/bot.lock`, –∞–ª–µ –ø–µ—Ä–µ–¥ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è–º —Ñ–∞–π–ª –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è, –∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ä—É—á–Ω–∏–π `ps`-–ø–æ—à—É–∫.

**–©–æ –∑–º—ñ–Ω–∏—Ç–∏:**
- –°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–∫—Ä–µ–º–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä –±–ª–æ–∫—É–≤–∞–Ω—å (–∫–ª–∞c `ProcessLock`) —ñ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, —è–∫–∏–π –Ω–µ –≤–∏–¥–∞–ª—è—î —Ñ–∞–π–ª –¥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è `fcntl`-–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –π –≥–∞—Ä–∞–Ω—Ç—É—î `close()` —É `finally`.
- –ó–∞–º—ñ–Ω–∏—Ç–∏ `kill_existing_bot_processes()` –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è PID —ñ–∑ lock-—Ñ–∞–π–ª—É –∞–±–æ –Ω–∞ systemd `RuntimeDirectory`; –æ–±–º–µ–∂–∏—Ç–∏ SIGTERM –ª–∏—à–µ –≤–ª–∞—Å–Ω–æ–º—É –µ–∫–∑–µ–º–ø–ª—è—Ä—É.
- –ù–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è: —É –±–ª–æ—Ü—ñ `finally` –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `await application.stop()`, `await application.shutdown()` —ñ `await webhook_runner.cleanup()`, –ø–µ—Ä—à –Ω—ñ–∂ –∑–∞–∫—Ä–∏–≤–∞—Ç–∏ lock.
- –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ –ø–æ—Ä—Ç—É –¥–æ —Å—Ç–∞—Ä—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `asyncio.open_connection`) —ñ –∑—Ä–æ–∑—É–º—ñ–ª—ñ –ª–æ–≥–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:** –≤–∏–∫–ª—é—á–µ–Ω–Ω—è –¥—É–±–ª—å–æ–≤–∞–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, –ø—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤, –º–µ–Ω—à–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ –ø—ñ–¥ —á–∞—Å –¥–µ–ø–ª–æ—é.

### 6.2 –ê—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –≤–∏–∫–ª–∏–∫—ñ–≤ (P0)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ä–∞–∑:** Google Sheets (`src/google_sheets_service.py`) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π `gspread`, –≤–∏–∫–ª–∏–∫–∏ —è–∫–æ–≥–æ –Ω–∞–ø—Ä—è–º—É –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö handler-–∞—Ö. Jira-–ª–æ–≥—ñ–∫–∞ (`src/services.py`) –≤–∂–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ `httpx.AsyncClient`, –∞–ª–µ –∫–ª—ñ—î–Ω—Ç —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Ç, —â–æ –∑–∞–≤–∞–∂–∞—î –ø–µ—Ä–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ º—î–¥–Ω–∞–Ω–Ω—è.

**–©–æ –∑–º—ñ–Ω–∏—Ç–∏:**
- –î–ª—è Google Sheets –æ–±–≥–æ—Ä–Ω—É—Ç–∏ –≤–∏–∫–ª–∏–∫–∏ —É `asyncio.to_thread` –∞–±–æ –≤–∏–¥—ñ–ª–∏—Ç–∏ –æ–∫—Ä–µ–º–∏–π –≤–æ—Ä–∫–µ—Ä, —è–∫–∏–π –≤–∑–∞—î–º–æ–¥—ñ—î –∑—ñ —Å–ø–∏—Å–∫–æ–º –∑–∞–≤–¥–∞–Ω—å (`asyncio.Queue`). –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ (`lru_cache`/Redis) –∑ TTL.
- –î–ª—è Jira —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–ø—ñ–ª—å–Ω–∏–π `httpx.AsyncClient` —É `services.py`, —â–æ–± `_make_request` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ pool —ñ–∑ —Ç–∞–π–º–∞—É—Ç–∞–º–∏ —Ç–∞ retry-–ø–æ–ª—ñ—Ç–∏–∫–æ—é.
- –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤—Å—ñ Telegram-–æ–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π API `application.bot` (–ø–æ—Ç–æ—á–Ω–∏–π –∫–æ–¥ —É–∂–µ –¥–æ—Ç—Ä–∏–º—É—î—Ç—å—Å—è —Ü—å–æ–≥–æ, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ª–∏—à–µ –¥–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥—Ö—ñ–¥).
- –ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —Ç–∞–π–º–∞—É—Ç–∏ –π circuit-breaker: —è–∫—â–æ Google Sheets –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ, –ø—Ä–æ–≥—Ä–∞–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ –∫–µ—à —ñ —Å—Ç–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É —Å–ø—Ä–æ–±—É —É —á–µ—Ä–≥—É `user_manager.sync_pending_users()`.

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:** event-loop –Ω–µ –±–ª–æ–∫—É—î—Ç—å—Å—è, –∑–º–µ–Ω—à—É—î—Ç—å—Å—è –ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º, –∑–æ–≤–Ω—ñ—à–Ω—ñ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó —Å—Ç–∞—é—Ç—å –±—ñ–ª—å—à —Å—Ç—ñ–π–∫–∏–º–∏.

### 6.3 –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø–∞–π–ø–ª–∞–π–Ω—É Jira –≤–µ–±—Ö—É–∫—ñ–≤ (P1)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ä–∞–∑:** `handle_webhook` –≤–∞–ª—ñ–¥–æ–≤—É—î –ø–æ–¥—ñ—é, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–æ–Ω—É—î –≤–∞–∂–∫—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó (–ø–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –æ–±—Ä–æ–±–∫–∞ –≤–∫–ª–∞–¥–µ–Ω—å) –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å Jira. –û–±—Ä–æ–±–∫–∞ –≤–∫–ª–∞–¥–µ–Ω—å –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ, —â–æ –ø—ñ–¥–≤–∏—â—É—î –ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å.

**–©–æ –∑–º—ñ–Ω–∏—Ç–∏:**
- –í—ñ–¥–æ–∫—Ä–µ–º–∏—Ç–∏ ¬´–ø—Ä–∏–π–æ–º¬ª –≤—ñ–¥ ¬´–æ–±—Ä–æ–±–∫–∏¬ª: –ø—ñ—Å–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –ø–æ–¥—ñ—é –≤ `asyncio.Queue` (–∞–±–æ RabbitMQ/Redis stream) —ñ –Ω–µ–≥–∞–π–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ 200 OK.
- –ó–∞–ø—É—Å—Ç–∏—Ç–∏ `webhook_worker` —è–∫ –æ–∫—Ä–µ–º–∏–π asyncio-task, —è–∫–∏–π –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—î –ø–æ–¥—ñ—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `asyncio.Semaphore` –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ Jira/Telegram.
- –í–∏–Ω–µ—Å—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∫–ª–∞–¥–µ–Ω—å —É –≤—ñ–¥–∫–ª–∞–¥–µ–Ω—ñ –∑–∞–¥–∞—á—ñ; –¥–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è `PENDING_ATTACHMENTS_CACHE` –∑ —Ç–≤–µ—Ä–¥–∏–º –æ–±–º–µ–∂–µ–Ω–Ω—è–º —Ä–æ–∑–º—ñ—Ä—É –π –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–∏–º TTL-cleaner.
- –î–æ–¥–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç–µ–π —Ç–∏–ø—ñ–≤ –ø–æ–¥—ñ–π —Ç–∞ –¥—ñ—é—á–∏—Ö handler-—ñ–≤, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –≥—ñ–ª–æ–∫ `if` –Ω–∞ 2000+ —Ä—è–¥–∫—ñ–≤.

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:** Jira –æ—Ç—Ä–∏–º—É—î –º–∏—Ç—Ç—î–≤—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å, –∑–Ω–∏–∂—É—î—Ç—å—Å—è –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–µ—Ç—Ä–∞—ó–≤, –ø—ñ–¥–≤–∏—â—É—î—Ç—å—Å—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –æ–±—Ä–æ–±–∫–∏ –≤–∫–ª–∞–¥–µ–Ω—å.

### 6.4 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ Telegram (P1)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ä–∞–∑:** `src/handlers.py` –º—ñ—Å—Ç–∏—Ç—å —É—Å—ñ ConversationHandler-–∏, –∫–Ω–æ–ø–∫–∏, —Å—Ç–∞–Ω –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, `main_message_dispatcher` —Ç–∞ –¥—É–±–ª—ñ–∫–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤. –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–∞–Ω—ñ–≤ —Ä–æ–±–∏—Ç—å—Å—è –≤—Ä—É—á–Ω—É —á–µ—Ä–µ–∑ `context.user_data`.

**–©–æ –∑–º—ñ–Ω–∏—Ç–∏:**
- –†–æ–∑–±–∏—Ç–∏ —Ñ–∞–π–ª –Ω–∞ –º–æ–¥—É–ª—ñ: `handlers/auth.py`, `handlers/issues.py`, `handlers/profile.py`, `handlers/common.py`. –í–∏–Ω–µ—Å—Ç–∏ keyboards —ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ —É —Å–ø—ñ–ª—å–Ω–∏–π –ø–∞–∫–µ—Ç.
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ PTB ConversationHandler –∑ state-—Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ –∑–∞–º—ñ—Å—Ç—å —Ä—É—á–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ `in_conversation`. –î–ª—è –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö guard-—ñ–≤ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ `filters.ChatType.PRIVATE` + –∫–∞—Å—Ç–æ–º–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏.
- –í–∏—Ä—ñ–≤–Ω—è—Ç–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é handler-—ñ–≤: –∑–º–µ–Ω—à–∏—Ç–∏ –≥—Ä—É–ø–∏ –π —É–Ω–µ–º–æ–∂–ª–∏–≤–∏—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è `comment_handler`.
- –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å–Ω–∏–π —à–∞—Ä –¥–ª—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `issue_service.create_from_context`) —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ –≤ handler-–∞—Ö, —â–æ —Å–ø—Ä–æ—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.
- –û–∫—Ä–µ–º–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ ¬´reset¬ª —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –∑ –æ—á–∏—â–µ–Ω–Ω—è–º –∫–µ—à—É —á–µ—Ä–µ–∑ `user_state_manager.delete_user_state`.
- –î–æ–¥–∞—Ç–∏ –∂–æ—Ä—Å—Ç–∫—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ (—Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è `contact.user_id` —ñ–∑ `effective_user.id`) —Ç–∞ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–∫–æ–≤–∏—Ö —Å–ø—Ä–æ–±.

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:** –∫–æ–¥ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Å—Ç–∞–Ω–µ —á–∏—Ç–∞–±–µ–ª—å–Ω–∏–º, –ª–µ–≥—à–∏–º –¥–ª—è –ø–æ–∫—Ä–∏—Ç—Ç—è —Ç–µ—Å—Ç–∞–º–∏ –π —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è.

### 6.5 –û–±—Å–µ—Ä–≤–∞–±—ñ–ª—ñ—Ç—ñ —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ (P2)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ä–∞–∑:** —î `monitoring/monitor_bot.sh`, –∞–ª–µ –±–æ–π–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ. Rate-limit —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏—à–µ —á–µ—Ä–µ–∑ —Å–ª—É–∂–±–æ–≤–∏–π –µ–Ω–¥–ø–æ–π–Ω—Ç —É `jira_webhooks2.py`.

**–©–æ –∑–º—ñ–Ω–∏—Ç–∏:**
- –î–æ–¥–∞—Ç–∏ `/healthz` —ñ `/metrics` (Prometheus —Ñ–æ—Ä–º–∞—Ç) –¥–æ aiohttp –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É: –≥–ª–∏–±–∏–Ω–∞ `application.update_queue`, —á–µ—Ä–≥–∞ webhook-—ñ–≤, —Å–µ—Ä–µ–¥–Ω—ñ —á–∞—Å–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ Jira/Sheets.
- –í–±—É–¥—É–≤–∞—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –ª–æ–≥–∏ (JSON) —á–µ—Ä–µ–∑ `logging.LoggerAdapter` –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (issue_key, telegram_id, event_type).
- –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –∞–ª–µ—Ä—Ç–∏: watchdog –Ω–∞ —á–∏—Å–ª–æ –Ω–µ–≤–¥–∞–ª–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ–π Google Sheets, –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–µ—Ç—Ä–∞—ó–≤ Jira, –¥–æ–≤–∂–∏–Ω—É —á–µ—Ä–≥–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.
- –í–Ω–µ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é —É `MONITORING.md` —ñ–∑ –æ–ø–∏—Å–æ–º –¥–∞—à–±–æ—Ä–¥—ñ–≤ —Ç–∞ –ø–ª–µ–π–±—É–∫—ñ–≤ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤.

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:** —à–≤–∏–¥–∫–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è –¥–µ–≥—Ä–∞–¥–∞—Ü—ñ–π, –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å —Ä–æ–±–æ—Ç–∏ –±–æ—Ç–∞ –¥–ª—è —á–µ—Ä–≥–æ–≤–∏—Ö —ñ–Ω–∂–µ–Ω–µ—Ä—ñ–≤.

### 6.6 –ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ QA (P2)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ä–∞–∑:** —Ç–µ—Å—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤—Ä—É—á–Ω—É –ø—ñ—Å–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è.

**–©–æ –∑–º—ñ–Ω–∏—Ç–∏:**
- –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–∏–π –ø–∞–∫–µ—Ç `Tests/` —ñ–∑ –ø—ñ–¥–∫–∞—Ç–∞–ª–æ–≥–∞–º–∏ `unit`, `integration`, `load`.
- –î–ª—è unit-—Ç–µ—Å—Ç—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `pytest` + `pytest-asyncio`, –∑–∞–º–æ–∫–∞—Ç–∏ Jira/Telegram/Sheets —á–µ—Ä–µ–∑ `respx` —ñ `unittest.mock`.
- –î–æ–¥–∞—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π, —è–∫–∏–π —Å–∏–º—É–ª—é—î: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–¥–∞—á—ñ, –Ω–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è –∑ Jira.
- –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ GitHub Actions / GitLab CI, —è–∫–∏–π –∑–∞–ø—É—Å–∫–∞—î —Ç–µ—Å—Ç–∏ –π –±–∞–∑–æ–≤–∏–π `flake8`/`pyright` –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ—î–º.
- –ü—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Locust) –¥–ª—è –≤–µ–±—Ö—É–∫—ñ–≤ —ñ Telegram –æ–Ω–æ–≤–ª–µ–Ω—å, —â–æ–± –≤–∏–º—ñ—Ä—è—Ç–∏ –ø—Ä–æ–ø—É—Å–∫–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –ø—ñ—Å–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π.

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:** –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Ä–µ–≥—Ä–µ—Å—ñ—è–º, –ø—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–∞ —è–∫—ñ—Å—Ç—å —Ä–µ–ª—ñ–∑—ñ–≤.

### 6.7 –ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è, –¥–µ–ø–ª–æ–π —Ç–∞ –≤—ñ–¥–∫–∞—Ç (P2)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ä–∞–∑:** —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–∏—Å—É—Ç–Ω—ñ `restart.sh`, `activate_and_run.sh`, –∫–∞—Ç–∞–ª–æ–≥ `deployment/` —ñ–∑ —á–µ–∫–ª—ñ—Å—Ç–∞–º–∏, –∞–ª–µ –ø—Ä–æ—Ü–µ—Å –¥–µ–ø–ª–æ—é —Ç–∞ –≤—ñ–¥–∫–∞—Ç—É –Ω–µ –æ–ø–∏—Å–∞–Ω–∏–π —É —î–¥–∏–Ω—ñ–π –ø—Ä–æ—Ü–µ–¥—É—Ä—ñ.

**–©–æ –∑–º—ñ–Ω–∏—Ç–∏:**
- –û–Ω–æ–≤–∏—Ç–∏ `deployment/DEPLOYMENT_GUIDE.md`, –¥–æ–¥–∞–≤—à–∏ —Å—Ü–µ–Ω–∞—Ä—ñ–π ¬´blue/green¬ª –∞–±–æ ¬´–∫–∞–Ω–∞—Ä–µ–π–∫–∞¬ª –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º systemd unit (`telegram-bot.service`).
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑—É–≤–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∏: `restart.sh` –º–∞—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–æ–≤–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ç–∞ –∫–æ—Ä–µ–∫—Ç–Ω–µ –∑—É–ø–∏–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑ `systemctl stop/start`.
- –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ—î–º (lint, —Ç–µ—Å—Ç–∏, –º—ñ–≥—Ä–∞—Ü—ñ—ó) —ñ –∫–æ–Ω—Ç—Ä–æ–ª—ñ–Ω–≥ –ø—ñ—Å–ª—è (healthcheck + smoke-test –∫–æ–º–∞–Ω–¥–æ—é `/start`).
- –ó–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω–∏–π –ø–∞–∫–µ—Ç (`backups/`) –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –º–∞—Ä–∫—É–≤–∞–Ω–Ω—è–º –≤–µ—Ä—Å—ñ—ó –π create_secure_backup.sh —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ —É –ø–∞–π–ø–ª–∞–π–Ω.
- –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ —á–µ–∫–ª—ñ—Å—Ç rollback (–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ build, –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è lock, –æ—á–∏—â–µ–Ω–Ω—è webhook-—ñ–≤) —É `deployment/deployment_checklist.md`.

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:** –∑—Ä–æ–∑—É–º—ñ–ª–∏–π —Ç–∞ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∏–π –ø—Ä–æ—Ü–µ—Å —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è, –≥–æ—Ç–æ–≤–∏–π –ø–ª–∞–Ω –≤—ñ–¥–∫–∞—Ç—É —É –≤–∏–ø–∞–¥–∫—É —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—É.

## 7. –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏
- –ü–æ—á–∞—Ç–∏ –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –º–µ—Ö–∞–Ω—ñ–∑–º—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –π –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∏ ‚Äî —Ü–µ –≥–æ–ª–æ–≤–Ω—ñ —Ä–∏–∑–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ —Å–µ—Ä–≤—ñ—Å—É.
- –ü–∞—Ä–∞–ª–µ–ª—å–Ω–æ —Å–ø–ª–∞–Ω—É–≤–∞—Ç–∏ —Ä–æ–∑–±–∏—Ç—Ç—è `handlers.py` –Ω–∞ –ª–æ–≥—ñ—á–Ω—ñ –º–æ–¥—É–ª—ñ, —â–æ–± –ø–æ–¥–∞–ª—å—à—ñ –∑–º—ñ–Ω–∏ –±—É–ª–∏ –∫–µ—Ä–æ–≤–∞–Ω–∏–º–∏.
- –ü—ñ—Å–ª—è —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó ‚Äî –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–µ—Å—Ç–∏ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ä–µ–≥—Ä–µ—Å—ñ–π.

---
**–ì–æ—Ç–æ–≤–∏–π –¥–æ —É—Ç–æ—á–Ω–µ–Ω—å:** –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é –∫–æ–∂–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É –ø–æ–∫—Ä–∞—â–µ–Ω—å.
