# –†–ï–ó–ï–†–í–ù–ê –ö–û–ü–Ü–Ø –ü–Ü–°–õ–Ø –ü–ï–†–ï–ó–ê–ü–£–°–ö–£ –ë–û–¢–ê
**–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è:** 28 —á–µ—Ä–≤–Ω—è 2025, 22:38  
**–§–∞–π–ª backup:** `Bot1_backup_20250628_223843_POST_RESTART.tar.gz`  
**–†–æ–∑–º—ñ—Ä:** 50MB

## ‚úÖ –ó–ê–í–ï–†–®–ï–ù–Ü –ó–ê–í–î–ê–ù–ù–Ø

### 1. **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó add_comment_to_jira**
- ‚úÖ –î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `author_name: Optional[str] = None`
- ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ª–æ–≥—ñ–∫—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—è –∑ —ñ–º'—è–º –∞–≤—Ç–æ—Ä–∞
- ‚úÖ –§–æ—Ä–º–∞—Ç: `***–Ü–º'—è: {author_name} –¥–æ–¥–∞–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä:***\n\n{comment}`

### 2. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤**
- ‚úÖ –ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ `comment_handler()` –≤ handlers.py
- ‚úÖ –ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ `file_handler()` –≤ handlers.py  
- ‚úÖ –î–æ–¥–∞–Ω–æ –ª–æ–≥—ñ–∫—É –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è –ü–Ü–ë –∑ –ø—Ä–æ—Ñ—ñ–ª—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ fallback –¥–æ Google Sheets –∑–∞ Telegram ID

### 3. **–°–∏—Å—Ç–µ–º–∞ fallback –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ü–Ü–ë**
- ‚úÖ –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 1: `context.user_data["profile"]["full_name"]`
- ‚úÖ –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 2: `context.user_data["full_name"]`
- ‚úÖ –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 3: `find_user_by_telegram_id()` –∑ Google Sheets
- ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ü–Ü–ë

### 4. **–£—Å–ø—ñ—à–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞**
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ `restart.sh` (`chmod +x`)
- ‚úÖ –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ —ñ –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
- ‚úÖ –í—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –ø—Ä–∞—Ü—é—é—Ç—å: Telegram polling + Jira webhook —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ –æ—Å—Ç–∞–Ω–Ω—ñ –∑–º—ñ–Ω–∏ –¥–æ –∫–æ–¥—É

### 5. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ**
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ multiple test scripts –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é `add_comment_to_jira` –∑ author_name
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ Google Sheets fallback
- ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –Ω–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤

## üìÇ –ú–û–î–ò–§–Ü–ö–û–í–ê–ù–Ü –§–ê–ô–õ–ò

### `/home/Bot1/src/services.py`
```python
async def add_comment_to_jira(issue_key: str, comment: str, author_name: Optional[str] = None) -> None:
    """
    –î–æ–¥–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä –¥–æ –∑–∞–¥–∞—á—ñ Jira –∑ –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∞–≤—Ç–æ—Ä–∞
    """
    if author_name:
        full_comment = f"***–Ü–º'—è: {author_name} –¥–æ–¥–∞–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä:***\n\n{comment}"
    else:
        full_comment = comment
```

### `/home/Bot1/src/handlers.py`
**comment_handler():**
- –î–æ–¥–∞–Ω–æ –ª–æ–≥—ñ–∫—É –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è `author_name` –∑ –ø—Ä–æ—Ñ—ñ–ª—é
- –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ fallback –¥–æ Google Sheets
- –ü–µ—Ä–µ–¥–∞—á–∞ `author_name` –¥–æ `add_comment_to_jira()`

**file_handler():**
- –î–æ–¥–∞–Ω–æ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω—É –ª–æ–≥—ñ–∫—É –¥–ª—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ –∑ —Ñ–∞–π–ª–∞–º–∏
- –û–±—Ä–æ–±–∫–∞ caption —Ñ–∞–π–ª—ñ–≤ –∑ –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∞–≤—Ç–æ—Ä–∞

## üîß –¢–ï–•–ù–Ü–ß–ù–Ü –î–ï–¢–ê–õ–Ü

### –§–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—è:
```
***–Ü–º'—è: [–Ü–º'—è –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞] –¥–æ–¥–∞–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä:***

[–¢–µ–∫—Å—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä—è]
```

### –õ–æ–≥—ñ–∫–∞ –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è –ü–Ü–ë:
1. **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ:** `profile.full_name`
2. **–í –ø—Ä–æ—Ü–µ—Å—ñ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–¥–∞—á—ñ:** `user_data.full_name`
3. **Fallback:** Google Sheets lookup –∑–∞ `telegram_id`
4. **Default:** –ö–æ–º–µ–Ω—Ç–∞—Ä –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞

### –õ–æ–≥—É–≤–∞–Ω–Ω—è:
- `logger.info()` –¥–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ü–Ü–ë
- `logger.warning()` –¥–ª—è –ø–æ–º–∏–ª–æ–∫ Google Sheets fallback
- `logger.info()` –¥–ª—è –ø—Ä–æ—Ü–µ—Å—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤

## üöÄ –°–¢–ê–ù –ë–û–¢–ê

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–û–í–ù–Ü–°–¢–Æ –§–£–ù–ö–¶–Ü–û–ù–ê–õ–¨–ù–ò–ô**

**–ó–∞–ø—É—â–µ–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏:**
- ‚úÖ Telegram polling (–∫–æ–º–∞–Ω–¥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
- ‚úÖ Jira webhook server (–ø–æ—Ä—Ç 9443)  
- ‚úÖ SSL –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —á–µ—Ä–µ–∑ Nginx

**Process ID:** –î–∏–Ω–∞–º—ñ—á–Ω–∏–π (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ)

## üìã –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò

1. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ production** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏
2. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥—ñ–≤** - –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤
3. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è Google Sheets fallback** - –º–æ–∂–ª–∏–≤–µ –∫–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

---
**–ó–≤—ñ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ:** GitHub Copilot  
**Backup –±–µ–∑–ø–µ—á–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤:** `/home/Bot1/backups/`
