#!/usr/bin/env python3
"""
–î—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞–Ω—É –±–æ—Ç–∞ —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
"""
import asyncio
import sys
import os
import json

# –î–æ–¥–∞—î–º–æ —à–ª—è—Ö –¥–æ src
sys.path.append('/home/Bot1/src')
sys.path.append('/home/Bot1')

from src.services import find_user_by_jira_issue_key

async def diagnose():
    """–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å—Ç–∞–Ω—É –±–æ—Ç–∞"""
    
    print("üîç –î–Ü–ê–ì–ù–û–°–¢–ò–ö–ê –°–¢–ê–ù–£ –ë–û–¢–ê")
    print("=" * 50)
    
    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∑–∞ —è–∫–∏–º issue –º–∏ –ø—Ä–∞—Ü—é—î–º–æ
    test_issue = "SD-42403"  # –ó –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    
    print(f"üéØ –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ issue: {test_issue}")
    
    try:
        user_data = await find_user_by_jira_issue_key(test_issue)
        print(f"üìã –î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ Jira: {json.dumps(user_data, ensure_ascii=False, indent=2)}")
        
        if user_data:
            telegram_id = user_data.get("telegram_id")
            print(f"üì± Telegram ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {telegram_id}")
            
            # –ü–æ—è—Å–Ω—é—î–º–æ –ø—Ä–æ–±–ª–µ–º—É
            print()
            print("üí° –ü–†–û–ë–õ–ï–ú–ê:")
            print("–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ Telegram –¥–æ–¥–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä –¥–æ –∑–∞–¥–∞—á—ñ,")
            print("–±–æ—Ç –ø–æ–≤–∏–Ω–µ–Ω –æ—Ç—Ä–∏–º–∞—Ç–∏ –ü–Ü–ë –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.")
            print("–ê–ª–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º —è–∫—â–æ:")
            print("1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π —á–µ—Ä–µ–∑ /start")
            print("2. –î–∞–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—é –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ")
            print("3. –ë–æ—Ç –±—É–≤ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∏–π —ñ –≤—Ç—Ä–∞—Ç–∏–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç")
            print()
            
            print("üõ†Ô∏è –†–Ü–®–ï–ù–ù–Ø:")
            print("–ü–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ü–Ü–ë –∑ Google Sheets –∑–∞ Telegram ID")
            print("—ñ –∑–±–µ—Ä–µ–≥—Ç–∏ –π–æ–≥–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –Ω–∞–ø—Ä—è–º—É")
            
        else:
            print("‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ")
            
    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞: {e}")

if __name__ == "__main__":
    asyncio.run(diagnose())
